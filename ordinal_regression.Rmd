---
title: "ordinal_regression"
output: html_document
date: "2023-07-11"
---

```{r}
library(tidyverse)
library(dplyr)
library(pdftools)
library(MASS)
source("model_function1.R")
source("model_function2.R")
```

```{r}
# load data 
level_113 <- model_function("/Users/lilykasperek/Desktop/Fellowship2023/eval_pdfs/STAT113_Spring_2020_2.pdf")
level_213 <- model_function("/Users/lilykasperek/Desktop/Fellowship2023/eval_pdfs/STAT213_Spring_2020_1.pdf")
level_234 <- model_function("/Users/lilykasperek/Desktop/Fellowship2023/eval_pdfs/STAT234_Fall_2020_1.pdf")
all_levels <- bind_rows(level_113, level_213, level_234) 
all_levels <- all_levels |> dplyr::filter(full_question == "Q6c. Effective")
  
# separate course column 
all_levels <- all_levels |> 
  separate(col = course, into = c("Course_Level", "Section"),
                       sep = "0") 
# delete section column
all_levels <- all_levels |> 
  dplyr::select(-Section) 
# filter out different likert scale 
#all_levels <- all_levels |> 
  #dplyr::filter(responses != "Too High" &
                                #responses != "Too Low" &
                                #responses != "Appropriate" &
                                #responses != "Somewhat High" &
                                #responses != "Somewhat Low" &
                                  #full_question == "Q6c. Effective")
# select columns needed for model 
all_levels <- all_levels |> 
  dplyr::select(full_question, Course_Level, responses_hm, everything())
```

```{r}
# fct_collapse() to prevent errors 
all_levels <- all_levels |> 
  dplyr::mutate(new_responses = fct_collapse(responses_hm,
                                                  Agree = c("AgreeStrongly",
                                                            "Agree"),
                                                  Neutral = c("AgreeSomewhat",
                                                              "Neutral",
                                                              "DisagreeSomewhat"),
                                                  Disagree = c("Disagree",
                                                               "DisagreeStrongly"))) 
# check new_responses
all_levels <- all_levels |>
  dplyr::select(new_responses, everything()) 
# use uncount() for response to show up correct amount of times 
model <- all_levels |> 
  uncount(count_hm)
```

```{r}
summary(model)
# fit model
model_fit <- polr(new_responses ~ Course_Level, data = model, Hess = TRUE)
model_fit2 <- polr(responses_hm ~ Course_Level, data = model, Hess = TRUE)
# summary of fit model collapsed responses
summary(model_fit)
(ctable <- coef(summary(model_fit)))
p <- pnorm(abs(ctable[, "t value"]), lower.tail = FALSE) * 2
(ctable <- cbind(ctable, "p value" = p))
exp(coef(model_fit))
# summary of fit model old responses
summary(model_fit2)
(ctable2 <- coef(summary(model_fit2)))
p <- pnorm(abs(ctable2[, "t value"]), lower.tail = FALSE) * 2
(ctable <- cbind(ctable2, "p value" = p))
exp(coef(model_fit2))
```

```{r}
lev_113 <- model_function2("/Users/lilykasperek/Desktop/Fellowship2023/eval_pdfs/STAT113_Spring_2020_2.pdf")
lev_213 <- model_function2("/Users/lilykasperek/Desktop/Fellowship2023/eval_pdfs/STAT213_Spring_2020_1.pdf")
lev_234 <- model_function2("/Users/lilykasperek/Desktop/Fellowship2023/eval_pdfs/STAT234_Fall_2020_1.pdf")
all_levs <- bind_rows(lev_113, lev_213, lev_234) 
all_levs <- all_levs |>
  separate(col = course, into = c("Course_Level", "Section"),
                       sep = "0") 
all_levs <- all_levs |>
  dplyr::select(-Section)
all_levs <- all_levs |>
  dplyr::select(full_question, Course_Level, responses, everything())
all_levs <- all_levs |> mutate(responses = as.factor(responses))
levels(all_levs$responses)
all_levs <- all_levs |> mutate(new_responses = factor(responses,
                                          levels = c("Too Low",
                                                     "Somewhat Low",
                                                     "Appropriate",
                                                     "Somewhat High",
                                                     "Too High")))
levels(all_levs$new_responses)
all_levs <- all_levs |>
  mutate(count = as.double(n_students))
all_levs <- all_levs |>
  uncount(count)
model_2 <- all_levs |>
  filter(full_question == "Q4c. Sophistication")
```

```{r}
summary(model_2)
mod_fit <- polr(new_responses ~ Course_Level, data = model_2, Hess = TRUE)
mod_fit2 <- polr(responses ~ Course_Level, data = model_2, Hess = TRUE)
# summary of fit model new responses
summary(mod_fit)
(ctable_mod <- coef(summary(mod_fit)))
p <- pnorm(abs(ctable_mod[, "t value"]), lower.tail = FALSE) * 2
(ctable <- cbind(ctable_mod, "p value" = p))
exp(coef(mod_fit))
# summary of fit model old responses
summary(mod_fit2)
(ctable_mod2 <- coef(summary(mod_fit2)))
p <- pnorm(abs(ctable_mod2[, "t value"]), lower.tail = FALSE) * 2
(ctable <- cbind(ctable_mod2, "p value" = p))
exp(coef(mod_fit2))
```
