---
title: "visualizations"
output: html_document
date: "2023-06-06"
---

```{r}
library(readxl)
library(tidyverse)
evals_prof_p2 <- read_excel("data/evals_prof_p2.xlsx")

evals <- evals_prof_p2 |> 
  mutate(question = fct_recode(Question, Valuable = "1. Course has been a valuable educational experience",
                               Organized = "2. Effectively Organized",
                               Learning = "3. Environment Conducive to Learning",
                               Fair = "5a. Fair Assessment of Student work",
                                   Timely = "5b. Timely Assessment of Student Work",
                                   Constructive = "5c. Constructive Assessment of Student Work",
                                   Rec_Prof = "6a. Recommend Instructor to another student",
                                   Rec_Course = "6b. Recommend Course to another student",
                                   Effective = "6c. Instructor was an effective teacher")) |> select(Term, Course, question, everything()) |>
  select(-Question)

evals_pivot <- evals |> pivot_longer(cols = c('Agree strongly', Agree, 'Agree Somewhat', 
                               Neutral, 'Disagree Somewhat', Disagree, 'Disagree Strongly'),
                               names_to = "response", values_to = "count") |>
  mutate(response = fct_recode(response, AgreeStrongly = "Agree strongly",
                               AgreeSomewhat = 'Agree Somewhat',
                               DisagreeSomewhat = 'Disagree Somewhat',
                               DisagreeStrongly = 'Disagree Strongly')) |> mutate(response_2 = 
                       fct_relevel(response, c("DisagreeStrongly",
                                             "Disagree",
                                             "DisagreeSomewhat",
                                             "Neutral",
                                             "AgreeSomewhat",
                                             "Agree",
                                             "AgreeStrongly")))
evals_pivot
```

```{r}
evals_bad <- evals |>
  mutate(n = `Agree strongly` + Agree + `Agree Somewhat` + Neutral + `Disagree Somewhat` + Disagree + `Disagree Strongly`,
         meanscore_prof = 7 * `Agree strongly` / n + 6 * Agree / n +
           5 * `Agree Somewhat` / n + 4 * Neutral / n +
           3 * `Disagree Somewhat` / n + 2 * `Disagree` / n + 
           1 * `Disagree Strongly` / n) |>
  select(Term, Course, question, meanscore_prof, everything())

ggplot(data = evals_bad, aes(x = question, y = meanscore_prof)) +
  geom_col() +
  facet_wrap(~Term) +
  labs(x = "Question", y = "Average Response",
       title = "Comparing Average Responses",
       subtitle = "from Student Evaluation Data") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) 

evals_bad_2020 <- evals_bad |> filter(Term == "F20") |>
  filter(Course == "113-04" ) |>
  mutate(question_ordered = fct_reorder(.f = question, .x = meanscore_prof))
  
ggplot(data = evals_bad_2020, aes(x = question, y = meanscore_prof)) +
  geom_col() 

ggplot(data = evals_bad_2020, aes(x = question_ordered, y = meanscore_prof)) +
  geom_col() +
  coord_flip() +
  labs(x = "Question", y = "Average Response",
    title = "Comparing Average Responses",
       subtitle = "from Student Evaluation Data") +
   theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) 

ggplot(data = evals_bad_2020, aes(x = question_ordered, y = meanscore_prof)) +
  geom_segment(aes(x = question_ordered, xend = question_ordered,
                   y = 0, yend = meanscore_prof)) +
  geom_point() +
  coord_flip() +
  labs(x = "Question", y = "Average Response",
    title = "Comparing Average Responses",
       subtitle = "from Student Evaluation Data") +
   theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) 
```

```{r}
evals_2020 <- evals_pivot |> filter(Course == "113-04") |>
  filter(Term == "F20")

view_course <- evals_pivot |> arrange(Course)

evals_2020_full <- evals_pivot |> filter(Course == "113-01" |
                                           Course == "113-02" |
                                           Course == "113-03" |
                                           Course == "113-04" |
                                           Course == "113-05" |
                                           Course == "113-07") |>
  filter(Term == "F20")

evals_2020_full |> arrange(Course)

ggplot(data = evals_2020, aes(x = response, y = count)) +
  geom_col() + 
  facet_wrap(~question)

ggplot(data = evals_2020_full, aes(x = response, y = count)) +
  geom_col() + 
  facet_wrap(~question)

ggplot(data = evals_2020_full, aes(x = response, y = count)) +
  geom_col() + 
  facet_wrap(~question + Course)

evals_valuable <- evals_2020 |> filter(question == "Valuable")
evals_valuable2 <- evals_2020_full |> filter(question == "Valuable")

ggplot(data = evals_valuable, aes(x = response, y = count)) +
  geom_col() +
  facet_wrap(~Term) +
  theme_bw() +
  labs(title = "Course has been a valuable educational experience") +
  theme(plot.title = element_text(hjust = 0.5)) 

ggplot(data = evals_valuable2, aes(x = response, y = count)) +
  geom_col() +
  facet_wrap(~Term) +
  theme_bw() +
  labs(title = "Course has been a valuable educational experience") +
  theme(plot.title = element_text(hjust = 0.5)) +
  facet_wrap(~Course)
 
evals_organized <- evals_2020 |> filter(question == "Organized")
evals_organized2 <- evals_2020_full |> filter(question == "Organized")

ggplot(data = evals_organized, aes(x = response, y = count)) +
  geom_col() +
  facet_wrap(~Term) +
  theme_bw() +
  labs(title = "Effectively organized") +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(data = evals_organized2, aes(x = response, y = count)) +
  geom_col() +
  facet_wrap(~Term) +
  theme_bw() +
  labs(title = "Effectively organized") +
  theme(plot.title = element_text(hjust = 0.5)) +
  facet_wrap(~Course)
```

```{r}
evals_col <- evals_pivot |> mutate(value =
                          case_when(response == "DisagreeStrongly" ~ 1,
                                    response == "Disagree" ~ 2,
                                    response == "DisagreeSomewhat" ~ 3,
                                    response == "Neutral" ~ 4,
                                    response == "AgreeSomewhat" ~ 5,
                                    response == "Agree" ~ 6,
                                    response == "AgreeStrongly" ~ 7)) |>
  filter(Term == "F20") |> mutate(response_2 = 
                       fct_relevel(response, c("DisagreeStrongly",
                                             "Disagree",
                                             "DisagreeSomewhat",
                                             "Neutral",
                                             "AgreeSomewhat",
                                             "Agree",
                                             "AgreeStrongly")))

ggplot(data = evals_col, aes(x = response_2, y = count)) +
  geom_col() +
  labs(x = "Response",
       y = "Count",
       title = "Student Evaluation Data for",
       subtitle = "STAT-113 Fall 2020") +
   theme(plot.title = element_text(hjust = 0.5),
         plot.subtitle = element_text(hjust = 0.5)) 
```


