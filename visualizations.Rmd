---
title: "visualizations"
output: html_document
date: "2023-06-06"
---

```{r}
library(readxl)
library(tidyverse)
evals_prof_p2 <- read_excel("data/evals_prof_p2.xlsx")

evals_recode <- evals_prof_p2 |> 
  mutate(question = fct_recode(Question, Valuable = "1. Course has been a valuable educational experience",
                               Organized = "2. Effectively Organized",
                               Learning = "3. Environment Conducive to Learning",
                               Fair = "5a. Fair Assessment of Student work",
                                   Timely = "5b. Timely Assessment of Student Work",
                                   Constructive = "5c. Constructive Assessment of Student Work",
                                   Rec_Prof = "6a. Recommend Instructor to another student",
                                   Rec_Course = "6b. Recommend Course to another student",
                                   Effective = "6c. Instructor was an effective teacher")) |> select(Term, Course, question, everything()) |>
  select(-Question)
evals_recode

evals_pivot <- evals_recode |> pivot_longer(cols = c('Agree strongly', Agree, 'Agree Somewhat', 
                               Neutral, 'Disagree Somewhat', Disagree, 'Disagree Strongly'),
                               names_to = "response", values_to = "count") |>
  mutate(response = fct_recode(response, AgreeStrongly = "Agree strongly",
                               AgreeSomewhat = 'Agree Somewhat',
                               DisagreeSomewhat = 'Disagree Somewhat',
                               DisagreeStrongly = 'Disagree Strongly')) |> mutate(response_2 = 
                       fct_relevel(response, c("DisagreeStrongly",
                                             "Disagree",
                                             "DisagreeSomewhat",
                                             "Neutral",
                                             "AgreeSomewhat",
                                             "Agree",
                                             "AgreeStrongly")))
evals_pivot

evals <- evals_pivot |> filter(Course == "113-04" &
                                 Term == "F20") 
evals
```

"bad" visualizations
```{r}
# getting means from csv
evals_mean <- evals_recode %>%
  mutate(n = `Agree strongly` + Agree + `Agree Somewhat` + Neutral + `Disagree Somewhat` + Disagree + `Disagree Strongly`,
         meanscore = 7 * `Agree strongly` / n + 6 * Agree / n +
           5 * `Agree Somewhat` / n + 4 * Neutral / n +
           3 * `Disagree Somewhat` / n + 2 * `Disagree` / n + 
           1 * `Disagree Strongly` / n) |>
  filter(Course == "113-04" & Term == "F20") |> 
  select(meanscore, everything())
evals_mean <- evals_mean |>
  mutate(ordered = fct_reorder(.f = question,
                               .x = meanscore))

# bar graph
ggplot(data = evals_mean, aes(x = ordered, y = meanscore)) +
  geom_col() +
  coord_flip() +
  labs(x = "Mean",
       y = "Responses",
       title = "Average Responses",
       subtitle = "STAT 113-04 Fall 2020") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5,
                                  size = 16),
        plot.subtitle = element_text(hjust = 0.5))

# lollipop chart 
ggplot(data = evals_mean, aes(x = ordered, y = meanscore)) +
  geom_segment(aes(x = ordered, xend = ordered,
                   y = 0, yend = meanscore)) +
  geom_point() +
  coord_flip() +
  labs(x = "Mean",
       y = "Responses",
       title = "Average Responses",
       subtitle = "STAT 113-04 Fall 2020") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5,
                                  size = 16),
        plot.subtitle = element_text(hjust = 0.5))

## can make same visualization with summary of means df scraped from pdf 
core_som_df
core_som_df_viz <- core_som_df |> mutate(responses_ordered = 
                        fct_reorder(.f = responses,
                                    .x = mean))

ggplot(data = core_som_df_viz, aes(x = responses_ordered, y = mean)) +
  geom_col() +
  coord_flip() +
  labs(x = "Responses",
       y = "Mean",
       title = "Average Responses",
       subtitle = "STAT 113-04 Fall 2020") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5,
                                  size = 16),
        plot.subtitle = element_text(hjust = 0.5))
 
# lollipop chart
ggplot(data = core_som_df_viz, aes(x = responses_ordered, y = mean)) +
  geom_point() +
  geom_segment(aes(x = responses_ordered, xend = responses_ordered,
                   y = 0, yend = mean)) +
  coord_flip() +
  labs(x = "Responses",
       y = "Mean",
       title = "Average Responses",
       subtitle = "STAT 113-04 Fall 2020") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5,
                                  size = 16),
        plot.subtitle = element_text(hjust = 0.5))

# want to add text box explaining likert values/where the numbers come from 

  ##annotate("text", x = 3, y = 4, label = "Likert Values",
           ##size = 3) +
  ##annotate("text", x = 2.7, y = 4, label = "Agree Strongly = 7",
          ## size = 3) +
  ##annotate("text", x = 2.4, y = 4, label = "Agree = 6",
           ##size = 3)

# stacked bar plot 
ggplot(data = evals, aes(x = response_2, y = count,
                         fill = question)) +
  geom_col(position = "fill") +
  coord_flip() +
   labs(x = "Responses",
       y = "Proportion",
       fill = "Question",
       title = "Responses Across All Questions",
       subtitle = "STAT 113-04 Fall 2020") +
   theme_bw() +
  theme(plot.title = element_text(hjust = 0.5,
                                  size = 15),
        plot.subtitle = element_text(hjust = 0.5)) 

# making same visualization with scraped df 
ggplot(data = test, aes(x = responses_hm, y = count_hm,
                         fill = full_question)) +
  geom_col(position = "fill") +
  coord_flip() +
  labs(x = "Responses",
       y = "Count",
       fill = "Question",
       title = "Responses Across All Questions",
       subtitle = "STAT 113-04 Fall 2020") +
   theme_bw() +
  theme(plot.title = element_text(hjust = 0.5,
                                  size = 15),
        plot.subtitle = element_text(hjust = 0.5))
```

"good" visualizations using count
```{r}
# csv data 
evals

# bar graph, not specifying question with csv data 
ggplot(data = evals, aes(x = response_2, y = count)) +
  geom_col() +
  coord_flip() +
  labs(x = "Responses",
       y = "Count",
       title = "Responses Across All Questions",
       subtitle = "STAT 113-04 Fall 2020") +
   theme_bw() +
  theme(plot.title = element_text(hjust = 0.5,
                                  size = 15),
        plot.subtitle = element_text(hjust = 0.5))

# faceted with question
ggplot(data = evals, aes(x = response_2, y = count)) +
  geom_col() +
  coord_flip() +
  facet_wrap(~question) +
  labs(x = "Responses",
       y = "Count",
       title = "Responses Across All Questions",
       subtitle = "STAT 113-04 Fall 2020") +
   theme_bw() +
  theme(plot.title = element_text(hjust = 0.5,
                                  size = 15),
        plot.subtitle = element_text(hjust = 0.5))

# making same visualizations using scraped df
test

ggplot(data = test, aes(x = responses_hm, y = count_hm)) +
  geom_col() +
  labs(x = "Responses",
       y = "Count",
       title = "Responses Across All Questions",
       subtitle = "STAT 113-04 Fall 2020") +
  coord_flip() +
   theme_bw() +
  theme(plot.title = element_text(hjust = 0.5,
                                  size = 15),
        plot.subtitle = element_text(hjust = 0.5))

ggplot(data = test, aes(x = responses_hm, y = count_hm)) +
  geom_col() +
  labs(x = "Responses",
       y = "Count",
       title = "Responses Across All Questions",
       subtitle = "STAT 113-04 Fall 2020") +
  coord_flip() +
  facet_wrap(~full_question) +
   theme_bw() +
  theme(plot.title = element_text(hjust = 0.5,
                                  size = 15),
        plot.subtitle = element_text(hjust = 0.5))
```

student backgrounds
```{r}
enroll <- full_df |> filter(question == "primary reason for enrollment") 
enroll <- enroll |>
  mutate(responses_ordered = fct_reorder(.f = responses,
                             .x = n_students))

ggplot(data = enroll, aes(x = responses_ordered, y = n_students)) +
  geom_col() +
  labs(x = "Count",
       y = "Responses",
       title = "Primary Reason for Enrollment",
       subtitle = "STAT 113-04 Fall 2020") +
  coord_flip() +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

gen <- full_df |> filter(question == "gender")
ggplot(data = gen, aes(x = responses, y = n_students)) +
  geom_col() +
  labs(x = "Count",
       y = "Responses",
       title = "Primary Reason for Enrollment",
       subtitle = "STAT 113-04 Fall 2020") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```


